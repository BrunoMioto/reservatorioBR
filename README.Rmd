---
output: github_document
---

# **reservatoriosBR** <img src="man/figures/logo.png" align="right" width="25%" min-width="120px"/>

<!-- badges: start -->

[![lifecycle](https://lifecycle.r-lib.org/articles/figures/lifecycle-stable.svg)](https://www.tidyverse.org/lifecycle/#stable)
[![License](https://img.shields.io/badge/license-MIT-blueviolet.svg?style=flat)](https://github.com/brunomioto/reservatoriosBR/blob/main/LICENSE.md)
[![pix](https://img.shields.io/badge/Apoie%20com-PIX-brightgreen)](https://www.brunomioto.com.br/pix)
[![Twitter Follow](https://img.shields.io/twitter/follow/BrunoHMioto.svg?style=social)](https://twitter.com/BrunoHMioto)

<!-- badges: end -->

Pacote R para obtenção de dados dos principais reservatórios brasileiros a partir da plataforma [SAR-ANA](https://www.ana.gov.br/sar/).

Este pacote baixa e organiza os dados em uma estrutura para uso no R.

Atualmente estou buscando **voluntários** para testar as funções e dados. Se puder, [entre em contato](https://twitter.com/BrunoHMioto)!

Se utilizar em algum trabalho, cite ou me avise! Gostaria de saber como este pacote pode ajudar!

## Instalação

Este pacote apenas está disponível para a instalação pelo github usando o devtools: 

```{r, results='hide', message=FALSE, warning=FALSE}
#install.packages("devtools")
devtools::install_github('brunomioto/reservatoriosBR')
```

## Uso

Atualmente o pacote possui 3 funções:

- `reservatorio_sin()`
- `reservatorio_cantareira()`
- `reservatorio_nordeste_semiarido()`
- `ultima_medicao()`

### A função `reservatorio_sin()`

Utilize a função para obter os dados históricos dos principais reservatórios brasileiros que pertencem ao [SIN - Sistema Interligado Nacional](https://www.ana.gov.br/sar/sin). A imagem abaixo apresenta as bacias dos reservatórios contidos no SIN.

![Sistema Interligado Nacional](man/figures/modelo-principal-mapa-sin.png)

`reservatorio_sin(codigo_reservatorio, data_inicial, data_final)`

- `codigo_reservatorio` O código do reservatório de acordo com o SIN (você pode consultar a tabela com os códigos chamando `tabela_reservatorios`).
- `data_inicial` Data inicial do registro. Se for anterior à data de funcionamento, retorna a data de registro mais antiga.
- `data_final` Data final do registro. Pode ser usado `Sys.Date()` para retornar a data de registro mais recente.


```{r, message=FALSE, warning=FALSE}
library(reservatoriosBR)
reservatorio_sin(19058, "2000-01-01", "2019-12-31")
```

As variáveis retornadas são:

- `data_medicao` - Data da medição realizada
- `codigo_reservatorio` - Código do reservatório segundo o SAR-ANA
- `reservatorio` - Nome do reservatório
- `cota_m` - Cota, o nível do reservatório (m)
- `afluencia_m3_s` - Afluência (m³/s)
- `defluencia_m3_s` - Defluência (m³/s)
- `vazao_vertida_m3_s` - Vazão vertida (m³/s)
- `vazao_turbinada_m3_s` - Vazão turbinada (m³/s)
- `vazao_natural_m3_s` - Vazão natural (m³/s)
- `volume_util_percent` - Volume útil (%) - Alguns reservatórios retornam apenas NA
- `vazao_incremental_m3_s` - Vazão incremental (m³/s) - Retorna apenas NA

As unidades de medida foram mantidas no nome das variáveis para não haver problemas de interpretação.


Podemos utilizar estes dados históricos para fazer análises e gráficos. A Afluência(m³/s), por exemplo, mede a quantidade de água que chega nas represas.

```{r, warning = FALSE, message = FALSE, results = 'hide', fig.keep = 'all', dpi = 600, echo=FALSE, eval = FALSE}
library(ggplot2)

itaipu <- reservatorio_sin(19058, "1980-01-01", Sys.Date())

ggplot(itaipu, aes(x=data_medicao, y=afluencia_m3_s))+
  geom_line(color = "#377eb8")+
  scale_x_date(date_breaks = "years", date_labels = "%Y")+
  theme_bw()+
  labs(x="Data da medição",
       y = "Afluência (m³/s)")+
  coord_cartesian(xlim = c(as.Date("1994-01-01"), as.Date("2021-01-01")))
```

<img src="man/figures/plot1.png" align="center" width="100%" min-width="120px"/>

### A função `reservatorio_cantareira()`

Utilize a função para obter os dados históricos dos reservatórios brasileiros que pertencem ao [**sistema Cantareira**](https://www.ana.gov.br/sar/outros-sistemas-hidricos/cantareira). A imagem abaixo apresenta as bacias dos reservatórios contidos no Sistema Cantareira.

![Sistema Cantareira](man/figures/outros-sistemas-hidricos-cantareira-principal.png)

`reservatorio_cantareira(codigo_reservatorio, data_inicial, data_final)`

- `codigo_reservatorio` O código do reservatório de acordo com o SAR (são apenas 4 reservatórios).

```{r, echo=FALSE}
Reservatorio <- c("Jaguari-Jacareí", "Cachoeira", "Atibainha", "Paiva Castro")
Codigo <- c(29001, 29002, 29003, 29004)

tabela_cantareira <- data.frame(Reservatorio, Codigo)

knitr::kable(tabela_cantareira)
```

- `data_inicial` Data inicial do registro. Se for anterior à data de funcionamento, retorna a data de registro mais antiga.
- `data_final` Data final do registro. Pode ser usado `Sys.Date()` para retornar a data de registro mais recente.

As variáveis retornadas são:

- `data_medicao` - Data da medição realizada
- `codigo_reservatorio` - Código do reservatório segundo o SAR-ANA
- `reservatorio` - Nome do reservatório
- `cota_m` - Cota, o nível do reservatório (m)
- `volume_util_hm3` - Volume útil (hm³)
- `volume_util_percent` - Volume útil (%)
- `afluencia_m3_s` - Afluência (m³/s)
- `defluencia_m3_s` - Defluência (m³/s)

### A função `reservatorio_nordeste_semiarido()`

Utilize a função para obter os dados históricos dos reservatórios brasileiros que pertencem ao módulo [**Nordeste e Semiárido**](https://www.ana.gov.br/sar/nordeste-e-semiarido) do SAR. A imagem abaixo apresenta os estados dos reservatórios contidos no SAR.

![Sistema Cantareira](man/figures/mapa-principal-ns.png)

### A função `ultima_medicao()`

Essa função retorna a última medição (e somente ela) dos dados de um reservatório.

Fiz essa função pois ela fornece o **Volume útil** de alguns reservatórios que não estão inclusos no dataset criado pela função `dados_reservatorio()`, como é o exemplo de **Itaipu**.

`ultima_medicao(codigo_reservatorio)`

As variáveis retornadas são:

- `data_medicao` - Data da medição realizada
- `reservatorio` - Nome do reservatório
- `afluencia_m3_s` - Afluência (m³/s)
- `defluencia_m3_s` - Defluência (m³/s)
- `cota_m` - Cota, o nível do reservatório (m)
- `vazao_transferida` - Vazão transferida - Acho que sempre retorna `NA`
- `volume_util_percent` - Volume útil (%)
- `tipo` - Tipo? Ainda preciso descobrir o que isso significa

## O dataset `tabela_reservatorios`

Esse dataset já vem pré-carregado com o pacote! Nele estão algumas informações sobre os reservatórios que podem ser carregados com as funções acima.

São 708 reservatórios com 5 variáveis, sendo elas:

- `sistema` - Sistema o qual o reservatório pertence.
- `estado_1` - Estado o qual o reservatório pertence.
- `estado_2` - Se o reservatório fica entre dois estados, o segundo estado. A ordem não tem importância.
- `reservatorio` - O nome do reservatório.
- `codigo` - O código do reservatório segundo o SAR. Utilizado nas funções desse pacote.

```{r}
head(tabela_reservatorios)
```


## To-do

- Buscar outras bases de dados de reservatórios brasileiros

- Confirmar a confiabilidade dos dados extraídos

## Melhorias e sugestões

Tem alguma ideia para o pacote ou sugestão de como posso melhorá-lo? Crie uma nova [issue](https://github.com/brunomioto/reservatoriosBR/issues) para que eu possa ajudar!
